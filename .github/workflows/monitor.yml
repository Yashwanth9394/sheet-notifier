name: Sheet Availability Monitor

on:
  schedule:
    - cron: '0 * * * *'  # Run every hour
  workflow_dispatch:      # Allow manual trigger

permissions:
  contents: write  # Allow committing back to the repo

jobs:
  monitor:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: Run Monitor Script
        env:
          GOOGLE_SHEET_URL: ${{ secrets.GOOGLE_SHEET_URL }}
          # We don't need SendGrid here, assuming Config handles missing optional envs gracefully
          # if not, we might need dummy values.
          # checking config.py: it requires SENDGRID_API_KEY. We should provide it or dummy it.
          SENDGRID_API_KEY: "dummy" 
          SENDER_EMAIL: "dummy@example.com"
          RECIPIENT_EMAIL: "dummy@example.com"
        run: python monitor_sheet.py
        
      - name: Commit and Push Log
        run: |
          git config --global user.name 'Sheet Monitor Bot'
          git config --global user.email 'bot@noreply.github.com'
          git add monitoring_log.csv
          # Only commit if there are changes
          if git diff --staged --quiet; then
            echo "No changes to log"
          else
            git commit -m "ðŸ“ˆ Update sheet availability log"
            git push
          fi
